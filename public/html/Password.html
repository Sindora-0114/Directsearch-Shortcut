<!DOCTYPE html>
<html lang="ja-jp">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/Password.css">
    <title>パスワード生成</title>
</head>
<body>
    <div aria-controls="Password_type">
        <label for="length">パスワードの長さ:</label>
        <input type="number" id="length" min="8" max="32" value="10">
        <button id="generate">生成</button>
        <button id="Copy">パスワードをコピーする</button>
    </div>
    <div id="password"></div>

    <button id="close">ページを閉じる</button>

    <script>
        const closeButton = document.getElementById('close')

        closeButton.onclick = function(){
            window.close();
        }

    </script>

    <script>
        const lengthInput = document.getElementById('length');
        const generateButton = document.getElementById('generate');
        const passwordOutput = document.getElementById('password');
        const errorOutput = document.createElement('div');
        const copyButton = document.getElementById('Copy'); // Copyボタンの取得
    
        errorOutput.style.color = 'red';
        passwordOutput.parentNode.insertBefore(errorOutput, passwordOutput);
    
        let generatedPassword = ""; // 生成されたパスワードを保存する変数
    
        generateButton.addEventListener('click', () => {
            const length = parseInt(lengthInput.value);
            errorOutput.textContent = ''; 
    
            if (length > 32) {
                errorOutput.textContent = 'エラー: パスワードの長さは32文字以下で指定してください。';
                return; 
            }
    
            if(length < 10){
                errorOutput.textContent = "エラー: パスワードは10文字以上で設定してください。"
                return;
            }
    
            generatedPassword = generatePassword(length); // パスワードを生成し保存
            passwordOutput.textContent = generatedPassword; // 生成されたパスワードを表示
        });
    
        // Copyボタンにクリックイベントを追加
        copyButton.addEventListener('click', () => {
            if (generatedPassword) { // パスワードが生成されている場合のみコピー
                navigator.clipboard.writeText(generatedPassword)
                    .then(() => {
                        alert('パスワードをコピーしました！');
                    })
                    .catch(err => {
                        console.error('コピーに失敗しました:', err);
                        alert('クリップボードへのアクセスが許可されていません。手動でコピーしてください。');
                    });
            } else {
                alert('まずパスワードを生成してください。');
            }
        });
    
        function generatePassword(length) {
            const charset = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_-+={}[]|;:,.<>?";
            let password = "";
            for (let i = 0; i < length; i++) {
                const randomIndex = Math.floor(Math.random() * charset.length);
                password += charset.charAt(randomIndex);
            }
            return password;
        }
    </script>
    
</body>
</html>